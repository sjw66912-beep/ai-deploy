<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¾‹å¸ˆå·¥æ—¶è®°å½• - å¤šäººåä½œç‰ˆ</title>
  <!-- å¼•å…¥Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- å¼•å…¥Font Awesomeå›¾æ ‡ -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- è‡ªå®šä¹‰Tailwindé…ç½® -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#6B7280',
            light: '#F3F4F6',
            dark: '#1F2937'
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-shadow {
        box-shadow: 0 2px 10px rgba(22, 93, 255, 0.08);
      }
      .btn-hover {
        @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-0.5;
      }
      .form-card {
        @apply bg-white rounded-2xl card-shadow p-6 md:p-8 w-full max-w-md;
      }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans text-dark">
  <!-- ç™»å½•/æ³¨å†Œç•Œé¢ -->
  <div id="authPage" class="min-h-screen flex flex-col items-center justify-center px-4 py-8">
    <div class="mb-8 text-center">
      <i class="fa fa-clock-o text-primary text-3xl mb-2"></i>
      <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-primary">å¾‹å¸ˆå·¥æ—¶è®°å½•</h1>
      <p class="text-secondary mt-2">å¤šäººåä½œç‰ˆ | æ•°æ®ç‹¬ç«‹éš”ç¦»</p>
    </div>

    <div class="form-card mb-6">
      <!-- ç™»å½•/æ³¨å†Œæ ‡ç­¾åˆ‡æ¢ -->
      <div class="flex border-b border-gray-200 mb-6">
        <button id="loginTab" class="flex-1 py-2 font-medium text-primary border-b-2 border-primary">
          <i class="fa fa-sign-in mr-1"></i> ç™»å½•
        </button>
        <button id="registerTab" class="flex-1 py-2 font-medium text-secondary hover:text-primary">
          <i class="fa fa-user-plus mr-1"></i> æ³¨å†Œ
        </button>
      </div>

      <!-- ç™»å½•è¡¨å• -->
      <form id="loginForm" class="space-y-4">
        <div>
          <label for="loginUsername" class="block text-sm font-medium text-secondary mb-1">ç”¨æˆ·å <span class="text-red-500">*</span></label>
          <input 
            type="text" 
            id="loginUsername" 
            required
            placeholder="è¯·è¾“å…¥ä½ çš„ç”¨æˆ·å"
            class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
          >
        </div>
        <div>
          <label for="loginPwd" class="block text-sm font-medium text-secondary mb-1">å¯†ç  <span class="text-red-500">*</span></label>
          <input 
            type="password" 
            id="loginPwd" 
            required
            placeholder="è¯·è¾“å…¥ä½ çš„å¯†ç "
            class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
          >
        </div>
        <button 
          type="submit" 
          class="w-full bg-primary text-white px-4 py-2 rounded-lg flex items-center justify-center gap-2 btn-hover"
        >
          <i class="fa fa-sign-in"></i> ç«‹å³ç™»å½•
        </button>
      </form>

      <!-- æ³¨å†Œè¡¨å• (é»˜è®¤éšè—) -->
      <form id="registerForm" class="space-y-4 hidden">
        <div>
          <label for="regUsername" class="block text-sm font-medium text-secondary mb-1">ç”¨æˆ·å <span class="text-red-500">*</span></label>
          <input 
            type="text" 
            id="regUsername" 
            required
            placeholder="è¯·è®¾ç½®ç”¨æˆ·åï¼ˆå¦‚ï¼šå¼ å¾‹å¸ˆã€å¾‹æ‰€åç§°ï¼‰"
            class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
          >
          <p class="text-xs text-secondary mt-1">ç”¨æˆ·åå”¯ä¸€ï¼Œä¸å¯ä¿®æ”¹ï¼Œå»ºè®®ä½¿ç”¨æ˜“è¯†åˆ«åç§°</p>
        </div>
        <div>
          <label for="regPwd" class="block text-sm font-medium text-secondary mb-1">å¯†ç  <span class="text-red-500">*</span></label>
          <input 
            type="password" 
            id="regPwd" 
            required
            minlength="6"
            placeholder="è¯·è®¾ç½®å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰"
            class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
          >
        </div>
        <div>
          <label for="regPwdConfirm" class="block text-sm font-medium text-secondary mb-1">ç¡®è®¤å¯†ç  <span class="text-red-500">*</span></label>
          <input 
            type="password" 
            id="regPwdConfirm" 
            required
            placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç "
            class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
          >
        </div>
        <button 
          type="submit" 
          class="w-full bg-primary text-white px-4 py-2 rounded-lg flex items-center justify-center gap-2 btn-hover"
        >
          <i class="fa fa-user-plus"></i> ç«‹å³æ³¨å†Œ
        </button>
      </form>
    </div>

    <p class="text-xs text-secondary text-center">
      Â© 2026 å¾‹å¸ˆå·¥æ—¶è®°å½• | æœ¬åœ°å­˜å‚¨ Â· æ•°æ®å®‰å…¨ Â· å¤šäººåä½œ
    </p>
  </div>

  <!-- å·¥æ—¶è®°å½•ä¸»ç•Œé¢ (é»˜è®¤éšè—) -->
  <div id="mainApp" class="hidden">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="bg-white shadow-sm sticky top-0 z-10">
      <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center">
        <div class="flex items-center gap-2 mb-3 md:mb-0">
          <i class="fa fa-clock-o text-primary text-2xl"></i>
          <h1 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-primary">å¾‹å¸ˆå·¥æ—¶è®°å½•</h1>
        </div>
        <!-- ç”¨æˆ·ä¿¡æ¯ + æ€»å·¥æ—¶ -->
        <div class="flex items-center gap-4">
          <div class="bg-primary/10 px-4 py-2 rounded-lg flex items-center gap-2">
            <i class="fa fa-calculator text-primary"></i>
            <span class="text-sm md:text-base">æ€»å·¥æ—¶ï¼š<span id="totalHours" class="font-bold text-primary">0å°æ—¶0åˆ†é’Ÿ</span></span>
          </div>
          <div class="flex items-center gap-2">
            <span id="currentUser" class="text-sm font-medium hidden md:inline-block">ç”¨æˆ·å</span>
            <button id="logoutBtn" class="bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-lg text-sm flex items-center gap-1 transition-all">
              <i class="fa fa-sign-out text-secondary"></i>
              <span class="hidden sm:inline">é€€å‡º</span>
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="container mx-auto px-4 py-6">
      <!-- å·¥æ—¶å½•å…¥è¡¨å• -->
      <section class="bg-white rounded-xl p-5 card-shadow mb-6">
        <h2 class="text-lg md:text-xl font-semibold mb-4 flex items-center gap-2">
          <i class="fa fa-plus-circle text-primary"></i>æ–°å¢å·¥æ—¶è®°å½•
        </h2>
        <form id="timeRecordForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="md:col-span-2">
            <label for="caseName" class="block text-sm font-medium text-secondary mb-1">æ¡ˆä»¶åç§° <span class="text-red-500">*</span></label>
            <input 
              type="text" 
              id="caseName" 
              name="caseName" 
              required
              placeholder="è¯·è¾“å…¥æ¡ˆä»¶åç§°ï¼ˆå¦‚ï¼šXXå…¬å¸ä¸XXä¹°å–åˆåŒçº çº·ï¼‰"
              class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
            >
          </div>
          <div class="md:col-span-2">
            <label for="workContent" class="block text-sm font-medium text-secondary mb-1">å·¥ä½œå†…å®¹ <span class="text-red-500">*</span></label>
            <textarea 
              id="workContent" 
              name="workContent" 
              required
              rows="2"
              placeholder="è¯·è¾“å…¥å…·ä½“å·¥ä½œå†…å®¹ï¼ˆå¦‚ï¼šèµ·è‰èµ·è¯‰çŠ¶ã€ä¸å½“äº‹äººæ²Ÿé€šæ¡ˆä»¶ç»†èŠ‚ï¼‰"
              class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all resize-none"
            ></textarea>
          </div>
          <div>
            <label for="startTime" class="block text-sm font-medium text-secondary mb-1">å¼€å§‹æ—¶é—´ <span class="text-red-500">*</span></label>
            <input 
              type="datetime-local" 
              id="startTime" 
              name="startTime" 
              required
              class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
            >
          </div>
          <div>
            <label for="endTime" class="block text-sm font-medium text-secondary mb-1">ç»“æŸæ—¶é—´ <span class="text-red-500">*</span></label>
            <input 
              type="datetime-local" 
              id="endTime" 
              name="endTime" 
              required
              class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
            >
          </div>
          <div class="md:col-span-2 flex gap-3">
            <button 
              type="submit" 
              class="flex-1 bg-primary text-white px-4 py-2 rounded-lg flex items-center justify-center gap-2 btn-hover"
            >
              <i class="fa fa-save"></i> ä¿å­˜è®°å½•
            </button>
            <button 
              type="reset" 
              class="px-4 py-2 border border-gray-200 rounded-lg flex items-center justify-center gap-2 btn-hover"
            >
              <i class="fa fa-refresh"></i> é‡ç½®
            </button>
            <button 
              type="button" 
              id="clearAllBtn" 
              class="px-4 py-2 border border-red-200 bg-red-50 text-red-600 rounded-lg flex items-center justify-center gap-2 btn-hover"
            >
              <i class="fa fa-trash"></i> æ¸…ç©ºæ‰€æœ‰
            </button>
          </div>
        </form>
      </section>

      <!-- å·¥æ—¶ç»Ÿè®¡æ€»ç»“æ¨¡å— -->
      <section class="bg-white rounded-xl p-5 card-shadow mb-6">
        <h2 class="text-lg md:text-xl font-semibold mb-4 flex items-center gap-2">
          <i class="fa fa-bar-chart text-primary"></i>å·¥æ—¶ç»Ÿè®¡æ€»ç»“
        </h2>
        <!-- æ—¶é—´ç­›é€‰åŒºåŸŸ -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-5">
          <div>
            <label for="filterStartDate" class="block text-sm font-medium text-secondary mb-1">ç­›é€‰èµ·å§‹æ—¥æœŸ</label>
            <input type="date" id="filterStartDate" class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all">
          </div>
          <div>
            <label for="filterEndDate" class="block text-sm font-medium text-secondary mb-1">ç­›é€‰ç»“æŸæ—¥æœŸ</label>
            <input type="date" id="filterEndDate" class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all">
          </div>
          <div class="flex items-end">
            <button type="button" id="filterDateBtn" class="w-full bg-primary text-white px-4 py-2 rounded-lg flex items-center justify-center gap-2 btn-hover">
              <i class="fa fa-search"></i> ç­›é€‰ç»Ÿè®¡
            </button>
          </div>
        </div>
        <!-- ç»Ÿè®¡ç»“æœå±•ç¤º -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- å…¨éƒ¨æ¡ˆä»¶å·¥æ—¶ç»Ÿè®¡ -->
          <div class="border border-gray-100 rounded-lg p-4">
            <h3 class="font-medium text-primary mb-3">å…¨éƒ¨æ¡ˆä»¶å·¥æ—¶æ±‡æ€»</h3>
            <div id="caseTotalStats" class="space-y-2 max-h-64 overflow-y-auto">
              <p class="text-secondary text-sm">æš‚æ— æ•°æ®ï¼Œæ·»åŠ è®°å½•åè‡ªåŠ¨ç»Ÿè®¡</p>
            </div>
          </div>
          <!-- ç­›é€‰æ—¶æ®µç»Ÿè®¡ -->
          <div class="border border-gray-100 rounded-lg p-4">
            <h3 class="font-medium text-primary mb-3">æŒ‡å®šæ—¶æ®µå·¥æ—¶ç»Ÿè®¡</h3>
            <div class="mb-3">
              <p class="text-sm">æ—¶æ®µæ€»å·¥æ—¶ï¼š<span id="filterTotalHours" class="font-bold text-primary">0å°æ—¶0åˆ†é’Ÿ</span></p>
            </div>
            <div id="filterCaseStats" class="space-y-2 max-h-52 overflow-y-auto">
              <p class="text-secondary text-sm">è¯·é€‰æ‹©æ—¥æœŸå¹¶ç‚¹å‡»ç­›é€‰</p>
            </div>
          </div>
        </div>
      </section>

      <!-- å·¥æ—¶è®°å½•åˆ—è¡¨ -->
      <section class="bg-white rounded-xl p-5 card-shadow">
        <h2 class="text-lg md:text-xl font-semibold mb-4 flex items-center justify-between">
          <span class="flex items-center gap-2"><i class="fa fa-list-alt text-primary"></i>å·¥æ—¶è®°å½•åˆ—è¡¨</span>
          <span id="recordCount" class="text-sm text-secondary">å…± 0 æ¡è®°å½•</span>
        </h2>
        <div id="emptyTip" class="py-12 flex flex-col items-center justify-center text-secondary">
          <i class="fa fa-file-text-o text-4xl mb-3"></i>
          <p>æš‚æ— å·¥æ—¶è®°å½•ï¼Œå¿«æ¥æ·»åŠ ç¬¬ä¸€æ¡è®°å½•å§ï½</p>
        </div>
        <div id="recordList" class="space-y-3 hidden">
          <!-- è®°å½•é¡¹ç”±JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
      </section>
    </main>

    <footer class="mt-10 py-4 bg-white shadow-inner text-center text-secondary text-sm">
      <p>Â© 2026 å¾‹å¸ˆå·¥æ—¶è®°å½• | å¤šäººåä½œç‰ˆ | æ•°æ®æœ¬åœ°ç‹¬ç«‹å­˜å‚¨</p>
    </footer>
  </div>

  <script>
    // å…¨å±€æ ¸å¿ƒå˜é‡
    let editId = null;          // ç¼–è¾‘çŠ¶æ€è®°å½•ID
    let currentUser = null;     // å½“å‰ç™»å½•ç”¨æˆ·
    const STORAGE_KEY_USERS = 'lawyerTimeRecordUsers'; // æ‰€æœ‰ç”¨æˆ·å­˜å‚¨Key
    const STORAGE_KEY_LOGIN = 'lawyerTimeRecordLogin'; // ç™»å½•æ€å­˜å‚¨Key

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      // åˆå§‹åŒ–ç™»å½•/æ³¨å†Œç›¸å…³äº‹ä»¶
      initAuthEvents();
      // æ£€æŸ¥ç™»å½•æ€ï¼Œè‡ªåŠ¨ç™»å½•
      checkLoginStatus();
      // åˆå§‹åŒ–ä¸»åº”ç”¨äº‹ä»¶ï¼ˆç™»å½•åè§¦å‘ï¼‰
      initAppEvents();
    });

    // ====================== ç™»å½•/æ³¨å†Œæ ¸å¿ƒåŠŸèƒ½ ======================
    /**
     * åˆå§‹åŒ–ç™»å½•/æ³¨å†Œæ ‡ç­¾ã€è¡¨å•äº‹ä»¶
     */
    function initAuthEvents() {
      // ç™»å½•/æ³¨å†Œæ ‡ç­¾åˆ‡æ¢
      document.getElementById('loginTab').addEventListener('click', () => {
        switchAuthTab('login');
      });
      document.getElementById('registerTab').addEventListener('click', () => {
        switchAuthTab('register');
      });

      // ç™»å½•è¡¨å•æäº¤
      document.getElementById('loginForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.getElementById('loginUsername').value.trim();
        const pwd = document.getElementById('loginPwd').value.trim();
        handleLogin(username, pwd);
      });

      // æ³¨å†Œè¡¨å•æäº¤
      document.getElementById('registerForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.getElementById('regUsername').value.trim();
        const pwd = document.getElementById('regPwd').value.trim();
        const pwdConfirm = document.getElementById('regPwdConfirm').value.trim();
        handleRegister(username, pwd, pwdConfirm);
      });
    }

    /**
     * åˆ‡æ¢ç™»å½•/æ³¨å†Œæ ‡ç­¾
     * @param {string} type - login/register
     */
    function switchAuthTab(type) {
      const loginTab = document.getElementById('loginTab');
      const registerTab = document.getElementById('registerTab');
      const loginForm = document.getElementById('loginForm');
      const registerForm = document.getElementById('registerForm');

      if (type === 'login') {
        loginTab.classList.add('text-primary', 'border-b-2', 'border-primary');
        loginTab.classList.remove('text-secondary');
        registerTab.classList.remove('text-primary', 'border-b-2', 'border-primary');
        registerTab.classList.add('text-secondary');
        loginForm.classList.remove('hidden');
        registerForm.classList.add('hidden');
      } else {
        registerTab.classList.add('text-primary', 'border-b-2', 'border-primary');
        registerTab.classList.remove('text-secondary');
        loginTab.classList.remove('text-primary', 'border-b-2', 'border-primary');
        loginTab.classList.add('text-secondary');
        registerForm.classList.remove('hidden');
        loginForm.classList.add('hidden');
      }
    }

    /**
     * å¤„ç†ç”¨æˆ·æ³¨å†Œ
     * @param {string} username - ç”¨æˆ·å
     * @param {string} pwd - å¯†ç 
     * @param {string} pwdConfirm - ç¡®è®¤å¯†ç 
     */
    function handleRegister(username, pwd, pwdConfirm) {
      // åŸºç¡€æ ¡éªŒ
      if (!username) {
        alert('è¯·è¾“å…¥ç”¨æˆ·åï¼');
        return;
      }
      if (pwd.length < 6) {
        alert('å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½ï¼');
        return;
      }
      if (pwd !== pwdConfirm) {
        alert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´ï¼');
        return;
      }

      // è·å–å·²æœ‰ç”¨æˆ·
      let users = JSON.parse(localStorage.getItem(STORAGE_KEY_USERS)) || [];
      // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
      const userExists = users.some(user => user.username === username);
      if (userExists) {
        alert('è¯¥ç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¯·æ›´æ¢ï¼');
        return;
      }

      // æ–°å¢ç”¨æˆ·ï¼ˆå¯†ç ç®€å•åŠ å¯†ï¼Œæœ¬åœ°å­˜å‚¨åŸºç¡€é˜²æŠ¤ï¼‰
      users.push({
        username,
        pwd: simpleEncrypt(pwd), // å¯†ç åŠ å¯†å­˜å‚¨
        createTime: new Date().toISOString()
      });
      localStorage.setItem(STORAGE_KEY_USERS, JSON.stringify(users));

      alert('æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•');
      switchAuthTab('login');
      document.getElementById('loginUsername').value = username;
      document.getElementById('loginPwd').value = '';
    }

    /**
     * å¤„ç†ç”¨æˆ·ç™»å½•
     * @param {string} username - ç”¨æˆ·å
     * @param {string} pwd - å¯†ç 
     */
    function handleLogin(username, pwd) {
      // åŸºç¡€æ ¡éªŒ
      if (!username || !pwd) {
        alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼');
        return;
      }

      // è·å–å·²æœ‰ç”¨æˆ·
      let users = JSON.parse(localStorage.getItem(STORAGE_KEY_USERS)) || [];
      // æŸ¥æ‰¾ç”¨æˆ·å¹¶éªŒè¯å¯†ç 
      const user = users.find(item => item.username === username && simpleDecrypt(item.pwd) === pwd);
      if (!user) {
        alert('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼');
        return;
      }

      // ä¿å­˜ç™»å½•æ€
      currentUser = username;
      localStorage.setItem(STORAGE_KEY_LOGIN, JSON.stringify({
        username,
        loginTime: new Date().toISOString()
      }));

      // è¿›å…¥ä¸»åº”ç”¨
      enterMainApp();
    }

    /**
     * æ£€æŸ¥ç™»å½•æ€ï¼Œè‡ªåŠ¨ç™»å½•
     */
    function checkLoginStatus() {
      const loginInfo = JSON.parse(localStorage.getItem(STORAGE_KEY_LOGIN));
      if (loginInfo && loginInfo.username) {
        currentUser = loginInfo.username;
        enterMainApp();
      }
    }

    /**
     * é€€å‡ºç™»å½•
     */
    function handleLogout() {
      if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
        // æ¸…é™¤ç™»å½•æ€
        localStorage.removeItem(STORAGE_KEY_LOGIN);
        currentUser = null;
        editId = null;
        // è¿”å›ç™»å½•ç•Œé¢
        document.getElementById('authPage').classList.remove('hidden');
        document.getElementById('mainApp').classList.add('hidden');
        // æ¸…ç©ºç™»å½•è¡¨å•
        document.getElementById('loginForm').reset();
        document.getElementById('registerForm').reset();
        switchAuthTab('login');
      }
    }

    /**
     * è¿›å…¥ä¸»åº”ç”¨ç•Œé¢
     */
    function enterMainApp() {
      // æ›´æ–°å½“å‰ç”¨æˆ·åæ˜¾ç¤º
      document.getElementById('currentUser').textContent = currentUser;
      // åˆ‡æ¢ç•Œé¢
      document.getElementById('authPage').classList.add('hidden');
      document.getElementById('mainApp').classList.remove('hidden');
      // åˆå§‹åŒ–ä¸»åº”ç”¨
      initDefaultTime();
      renderRecordList();
      renderCaseTotalStats();
    }

    /**
     * ç®€å•åŠ å¯†å¯†ç ï¼ˆæœ¬åœ°å­˜å‚¨åŸºç¡€é˜²æŠ¤ï¼Œéä¸“ä¸šåŠ å¯†ï¼‰
     * @param {string} str - åŸå§‹å¯†ç 
     * @returns {string} åŠ å¯†åå­—ç¬¦ä¸²
     */
    function simpleEncrypt(str) {
      return btoa(unescape(encodeURIComponent(str))); // Base64åŠ å¯†
    }

    /**
     * ç®€å•è§£å¯†å¯†ç 
     * @param {string} str - åŠ å¯†å­—ç¬¦ä¸²
     * @returns {string} åŸå§‹å¯†ç 
     */
    function simpleDecrypt(str) {
      return decodeURIComponent(escape(atob(str))); // Base64è§£å¯†
    }

    // ====================== ä¸»åº”ç”¨æ ¸å¿ƒåŠŸèƒ½ï¼ˆé€‚é…å¤šç”¨æˆ·ï¼‰ ======================
    /**
     * åˆå§‹åŒ–ä¸»åº”ç”¨æ‰€æœ‰äº‹ä»¶
     */
    function initAppEvents() {
      // é€€å‡ºç™»å½•äº‹ä»¶
      document.getElementById('logoutBtn').addEventListener('click', handleLogout);
      // å·¥æ—¶è¡¨å•æäº¤
      document.getElementById('timeRecordForm').addEventListener('submit', handleFormSubmit);
      // æ¸…ç©ºæ‰€æœ‰è®°å½•
      document.getElementById('clearAllBtn').addEventListener('click', handleClearAll);
      // æ—¥æœŸç­›é€‰ç»Ÿè®¡
      document.getElementById('filterDateBtn').addEventListener('click', handleDateFilterStats);
    }

    /**
     * è·å–å½“å‰ç”¨æˆ·çš„ä¸“å±å­˜å‚¨Keyï¼ˆå®ç°æ•°æ®éš”ç¦»ï¼‰
     * @returns {string} å½“å‰ç”¨æˆ·çš„è®°å½•å­˜å‚¨Key
     */
    function getUserRecordKey() {
      return `lawyerTimeRecords_${currentUser}`;
    }

    // åˆå§‹åŒ–è¡¨å•é»˜è®¤æ—¶é—´
    function initDefaultTime() {
      const now = new Date();
      const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000);
      const formatTime = (date) => {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const hour = String(date.getHours()).padStart(2, '0');
        const minute = String(date.getMinutes()).padStart(2, '0');
        return `${year}-${month}-${day}T${hour}:${minute}`;
      };
      document.getElementById('startTime').value = formatTime(oneHourAgo);
      document.getElementById('endTime').value = formatTime(now);
    }

    // å¤„ç†è¡¨å•æäº¤ï¼ˆæ–°å¢/ç¼–è¾‘ï¼‰
    function handleFormSubmit(e) {
      e.preventDefault();
      const caseName = document.getElementById('caseName').value.trim();
      const workContent = document.getElementById('workContent').value.trim();
      const startTime = document.getElementById('startTime').value;
      const endTime = document.getElementById('endTime').value;

      if (new Date(startTime) >= new Date(endTime)) {
        alert('ç»“æŸæ—¶é—´å¿…é¡»æ™šäºå¼€å§‹æ—¶é—´ï¼Œè¯·é‡æ–°é€‰æ‹©ï¼');
        return;
      }

      const record = {
        caseName,
        workContent,
        startTime,
        endTime,
        duration: calculateDuration(startTime, endTime),
        totalMinutes: calcTotalMinutes(startTime, endTime),
        createTime: new Date().toISOString()
      };

      // ğŸ”¥ å…³é”®ï¼šè·å–å½“å‰ç”¨æˆ·çš„ä¸“å±è®°å½•
      let records = JSON.parse(localStorage.getItem(getUserRecordKey())) || [];

      if (editId) {
        records = records.map(item => item.id === editId ? { ...item, ...record } : item);
        editId = null;
        alert('è®°å½•ç¼–è¾‘æˆåŠŸï¼');
      } else {
        records.unshift({ id: generateUniqueId(), ...record });
        alert('è®°å½•æ·»åŠ æˆåŠŸï¼');
      }

      // ğŸ”¥ å…³é”®ï¼šä¿å­˜åˆ°å½“å‰ç”¨æˆ·çš„ä¸“å±å­˜å‚¨
      localStorage.setItem(getUserRecordKey(), JSON.stringify(records));
      this.reset();
      initDefaultTime();
      renderRecordList();
      renderCaseTotalStats();
    }

    // ç”Ÿæˆå”¯ä¸€ID
    function generateUniqueId() {
      return Date.now() + '-' + Math.floor(Math.random() * 10000);
    }

    // è®¡ç®—å·¥æ—¶ï¼ˆå±•ç¤ºç”¨ï¼šXå°æ—¶Xåˆ†é’Ÿï¼‰
    function calculateDuration(start, end) {
      const startMs = new Date(start).getTime();
      const endMs = new Date(end).getTime();
      const diffMs = endMs - startMs;
      const hours = Math.floor(diffMs / (60 * 60 * 1000));
      const minutes = Math.floor((diffMs % (60 * 60 * 1000)) / (60 * 1000));
      return `${hours}å°æ—¶${minutes}åˆ†é’Ÿ`;
    }

    // è®¡ç®—æ€»åˆ†é’Ÿæ•°ï¼ˆç»Ÿè®¡ä¸“ç”¨ï¼Œé¿å…å­—ç¬¦ä¸²æ‹†åˆ†è¯¯å·®ï¼‰
    function calcTotalMinutes(start, end) {
      const startMs = new Date(start).getTime();
      const endMs = new Date(end).getTime();
      const diffMs = endMs - startMs;
      return Math.floor(diffMs / (60 * 1000));
    }

    // åˆ†é’Ÿæ•°è½¬ä¸ºæ ‡å‡†å·¥æ—¶æ ¼å¼
    function minutesToHours(minutes) {
      const h = Math.floor(minutes / 60);
      const m = minutes % 60;
      return `${h}å°æ—¶${m}åˆ†é’Ÿ`;
    }

    // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
    function formatDisplayTime(timeStr) {
      const date = new Date(timeStr);
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      const hour = String(date.getHours()).padStart(2, '0');
      const minute = String(date.getMinutes()).padStart(2, '0');
      return `${year}-${month}-${day} ${hour}:${minute}`;
    }

    // æ¸²æŸ“è®°å½•åˆ—è¡¨+å…¨å±€æ€»å·¥æ—¶ï¼ˆé€‚é…å¤šç”¨æˆ·ï¼‰
    function renderRecordList() {
      // ğŸ”¥ å…³é”®ï¼šè·å–å½“å‰ç”¨æˆ·çš„ä¸“å±è®°å½•
      const records = JSON.parse(localStorage.getItem(getUserRecordKey())) || [];
      const recordListEl = document.getElementById('recordList');
      const emptyTipEl = document.getElementById('emptyTip');
      const recordCountEl = document.getElementById('recordCount');
      const totalHoursEl = document.getElementById('totalHours');

      recordCountEl.textContent = `å…± ${records.length} æ¡è®°å½•`;

      if (records.length === 0) {
        recordListEl.classList.add('hidden');
        emptyTipEl.classList.remove('hidden');
        totalHoursEl.textContent = '0å°æ—¶0åˆ†é’Ÿ';
        return;
      }

      recordListEl.classList.remove('hidden');
      emptyTipEl.classList.add('hidden');
      recordListEl.innerHTML = '';

      // è®¡ç®—å…¨å±€æ€»å·¥æ—¶
      const totalMinutes = records.reduce((sum, item) => sum + (item.totalMinutes || 0), 0);
      totalHoursEl.textContent = minutesToHours(totalMinutes);

      records.forEach(record => {
        const recordItem = document.createElement('div');
        recordItem.className = 'border border-gray-100 rounded-lg p-4 hover:border-primary/30 transition-all';
        recordItem.innerHTML = `
          <div class="flex flex-col md:flex-row md:justify-between md:items-start gap-2 mb-3">
            <h3 class="font-semibold text-lg flex items-center gap-2">
              <span class="text-primary">${record.caseName}</span>
              <span class="bg-primary/10 text-primary text-xs px-2 py-0.5 rounded-full">${record.duration}</span>
            </h3>
            <div class="flex gap-2">
              <button class="copy-btn text-secondary hover:text-primary transition-all" data-id="${record.id}" title="å¤åˆ¶æ¡ˆä»¶åç§°">
                <i class="fa fa-copy"></i>
              </button>
              <button class="edit-btn text-secondary hover:text-primary transition-all" data-id="${record.id}" title="ç¼–è¾‘è®°å½•">
                <i class="fa fa-pencil"></i>
              </button>
              <button class="delete-btn text-secondary hover:text-red-500 transition-all" data-id="${record.id}" title="åˆ é™¤è®°å½•">
                <i class="fa fa-trash"></i>
              </button>
            </div>
          </div>
          <p class="text-sm text-secondary mb-2"><i class="fa fa-file-text-o mr-1"></i>${record.workContent}</p>
          <div class="flex flex-wrap gap-4 text-xs text-secondary">
            <span><i class="fa fa-clock-o mr-1"></i>å¼€å§‹ï¼š${formatDisplayTime(record.startTime)}</span>
            <span><i class="fa fa-stop mr-1"></i>ç»“æŸï¼š${formatDisplayTime(record.endTime)}</span>
          </div>
        `;
        recordListEl.appendChild(recordItem);

        // ç»‘å®šæ“ä½œäº‹ä»¶
        recordItem.querySelector('.copy-btn').addEventListener('click', () => {
          navigator.clipboard.writeText(record.caseName).then(() => alert('æ¡ˆä»¶åç§°å·²å¤åˆ¶ï¼'));
        });
        recordItem.querySelector('.edit-btn').addEventListener('click', () => editRecord(record.id));
        recordItem.querySelector('.delete-btn').addEventListener('click', () => deleteRecord(record.id));
      });
    }

    // ç¼–è¾‘è®°å½•
    function editRecord(id) {
      // ğŸ”¥ å…³é”®ï¼šè·å–å½“å‰ç”¨æˆ·çš„ä¸“å±è®°å½•
      const records = JSON.parse(localStorage.getItem(getUserRecordKey())) || [];
      const record = records.find(item => item.id === id);
      if (!record) return;
      document.getElementById('caseName').value = record.caseName;
      document.getElementById('workContent').value = record.workContent;
      document.getElementById('startTime').value = record.startTime;
      document.getElementById('endTime').value = record.endTime;
      editId = id;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // åˆ é™¤å•æ¡è®°å½•
    function deleteRecord(id) {
      if (!confirm('ç¡®å®šåˆ é™¤è¿™æ¡è®°å½•ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼')) return;
      // ğŸ”¥ å…³é”®ï¼šè·å–å½“å‰ç”¨æˆ·çš„ä¸“å±è®°å½•
      let records = JSON.parse(localStorage.getItem(getUserRecordKey())) || [];
      records = records.filter(item => item.id !== id);
      localStorage.setItem(getUserRecordKey(), JSON.stringify(records));
      renderRecordList();
      renderCaseTotalStats();
      alert('è®°å½•å·²åˆ é™¤');
    }

    // æ¸…ç©ºæ‰€æœ‰è®°å½•ï¼ˆé€‚é…å¤šç”¨æˆ·ï¼‰
    function handleClearAll() {
      // ğŸ”¥ å…³é”®ï¼šè·å–å½“å‰ç”¨æˆ·çš„ä¸“å±è®°å½•
      const records = JSON.parse(localStorage.getItem(getUserRecordKey())) || [];
      if (records.length === 0) {
        alert('æš‚æ— è®°å½•å¯æ¸…ç©ºï¼');
        return;
      }
      if (confirm('è­¦å‘Šï¼šæ¸…ç©ºåæ‰€æœ‰æ•°æ®æ°¸ä¹…ä¸¢å¤±ï¼Œç¡®å®šç»§ç»­ï¼Ÿ')) {
        localStorage.removeItem(getUserRecordKey());
        renderRecordList();
        renderCaseTotalStats();
        handleDateFilterStats();
        alert('æ‰€æœ‰è®°å½•å·²æ¸…ç©º');
      }
    }

    // æ¸²æŸ“å…¨éƒ¨æ¡ˆä»¶çš„æ€»å·¥æ—¶ç»Ÿè®¡ï¼ˆé€‚é…å¤šç”¨æˆ·ï¼‰
    function renderCaseTotalStats() {
      // ğŸ”¥ å…³é”®ï¼šè·å–å½“å‰ç”¨æˆ·çš„ä¸“å±è®°å½•
      const records = JSON.parse(localStorage.getItem(getUserRecordKey())) || [];
      const statsEl = document.getElementById('caseTotalStats');
      
      if (records.length === 0) {
        statsEl.innerHTML = '<p class="text-secondary text-sm">æš‚æ— æ•°æ®ï¼Œæ·»åŠ è®°å½•åè‡ªåŠ¨ç»Ÿè®¡</p>';
        return;
      }

      // æŒ‰æ¡ˆä»¶åç§°èšåˆæ€»åˆ†é’Ÿæ•°
      const caseMap = {};
      records.forEach(item => {
        if (!caseMap[item.caseName]) caseMap[item.caseName] = 0;
        caseMap[item.caseName] += item.totalMinutes;
      });

      // è½¬ä¸ºæ•°ç»„å¹¶æŒ‰å·¥æ—¶é™åºæ’åº
      const caseStats = Object.entries(caseMap).sort((a, b) => b[1] - a[1]);
      
      let html = '';
      caseStats.forEach(([name, minutes]) => {
        html += `
          <div class="flex justify-between items-center text-sm">
            <span class="truncate mr-2" title="${name}">${name}</span>
            <span class="font-medium">${minutesToHours(minutes)}</span>
          </div>
        `;
      });
      statsEl.innerHTML = html;
    }

    // æŒ‰æ—¶é—´èŒƒå›´ç­›é€‰å¹¶ç»Ÿè®¡å·¥æ—¶ï¼ˆé€‚é…å¤šç”¨æˆ·ï¼‰
    function handleDateFilterStats() {
      const startDate = document.getElementById('filterStartDate').value;
      const endDate = document.getElementById('filterEndDate').value;
      // ğŸ”¥ å…³é”®ï¼šè·å–å½“å‰ç”¨æˆ·çš„ä¸“å±è®°å½•
      const records = JSON.parse(localStorage.getItem(getUserRecordKey())) || [];
      const filterTotalEl = document.getElementById('filterTotalHours');
      const filterCaseEl = document.getElementById('filterCaseStats');

      if (!startDate || !endDate) {
        filterTotalEl.textContent = '0å°æ—¶0åˆ†é’Ÿ';
        filterCaseEl.innerHTML = '<p class="text-secondary text-sm">è¯·å…ˆé€‰æ‹©èµ·å§‹å’Œç»“æŸæ—¥æœŸ</p>';
        return;
      }

      // ç­›é€‰æ—¥æœŸèŒƒå›´å†…çš„è®°å½•
      const filteredRecords = records.filter(item => {
        const recordDate = item.startTime.split('T')[0];
        return recordDate >= startDate && recordDate <= endDate;
      });

      // è®¡ç®—ç­›é€‰åæ€»å·¥æ—¶
      const filterTotalMinutes = filteredRecords.reduce((sum, item) => sum + item.totalMinutes, 0);
      filterTotalEl.textContent = minutesToHours(filterTotalMinutes);

      // æŒ‰æ¡ˆä»¶èšåˆç­›é€‰åæ•°æ®
      if (filteredRecords.length === 0) {
        filterCaseEl.innerHTML = '<p class="text-secondary text-sm">è¯¥æ—¶æ®µæ— å·¥æ—¶è®°å½•</p>';
        return;
      }

      const caseMap = {};
      filteredRecords.forEach(item => {
        if (!caseMap[item.caseName]) caseMap[item.caseName] = 0;
        caseMap[item.caseName] += item.totalMinutes;
      });

      const caseStats = Object.entries(caseMap).sort((a, b) => b[1] - a[1]);
      let html = '';
      caseStats.forEach(([name, minutes]) => {
        html += `
          <div class="flex justify-between items-center text-sm">
            <span class="truncate mr-2" title="${name}">${name}</span>
            <span class="font-medium">${minutesToHours(minutes)}</span>
          </div>
        `;
      });
      filterCaseEl.innerHTML = html;
    }
  </script>
</body>
</html>
